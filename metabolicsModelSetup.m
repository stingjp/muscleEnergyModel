function metabolicsModelSetup(modelFilename)
    import org.opensim.modeling.*
        
    muscleKeys = {'addbrev_r', ...
                    'addlong_r', ...
                    'addmagDist_r', ...
                    'addmagIsch_r', ...
                    'addmagMid_r', ...
                    'addmagProx_r', ...
                    'bflh_r', ...
                    'bfsh_r', ...
                    'edl_r', ...
                    'ehl_r', ...
                    'fdl_r', ...
                    'fhl_r', ...
                    'gaslat_r', ...
                    'gasmed_r', ...
                    'glmax1_r', ...
                    'glmax2_r', ...
                    'glmax3_r', ...
                    'glmed1_r', ...
                    'glmed2_r', ...
                    'glmed3_r', ...
                    'glmin1_r', ...
                    'glmin2_r', ...
                    'glmin3_r', ...
                    'grac_r', ...
                    'iliacus_r', ...
                    'perbrev_r', ...
                    'perlong_r', ...
                    'piri_r', ...
                    'psoas_r', ...
                    'recfem_r', ...
                    'sart_r', ...
                    'semimem_r', ...
                    'semiten_r', ...
                    'soleus_r', ...
                    'tfl_r', ...
                    'tibant_r', ...
                    'tibpost_r', ...
                    'vasint_r', ...
                    'vaslat_r', ...
                    'vasmed_r', ...
                    'addbrev_l', ...
                    'addlong_l', ...
                    'addmagDist_l', ...
                    'addmagIsch_l', ...
                    'addmagMid_l', ...
                    'addmagProx_l', ...
                    'bflh_l', ...
                    'bfsh_l', ...
                    'edl_l', ...
                    'ehl_l', ...
                    'fdl_l', ...
                    'fhl_l', ...
                    'gaslat_l', ...
                    'gasmed_l', ...
                    'glmax1_l', ...
                    'glmax2_l', ...
                    'glmax3_l', ...
                    'glmed1_l', ...
                    'glmed2_l', ...
                    'glmed3_l', ...
                    'glmin1_l', ...
                    'glmin2_l', ...
                    'glmin3_l', ...
                    'grac_l', ...
                    'iliacus_l', ...
                    'perbrev_l', ...
                    'perlong_l', ...
                    'piri_l', ...
                    'psoas_l', ...
                    'recfem_l', ...
                    'sart_l', ...
                    'semimem_l', ...
                    'semiten_l', ...
                    'soleus_l', ...
                    'tfl_l', ...
                    'tibant_l', ...
                    'tibpost_l', ...
                    'vasint_l', ...
                    'vaslat_l', ...
                    'vasmed_l'};
    ratioVals = [0.5, ...
        0.5, ...
        0.55200000000000005, ...
        0.55200000000000005, ...
        0.55200000000000005, ...
        0.55200000000000005, ...
        0.54249999999999998, ...
        0.52900000000000003, ...
        0.75, ...
        0.75, ...
        0.59999999999999998, ...
        0.59999999999999998, ...
        0.50700000000000001, ...
        0.56599999999999995, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.5, ...
        0.5, ...
        0.59999999999999998, ...
        0.59999999999999998, ...
        0.5, ...
        0.5, ...
        0.38650000000000001, ...
        0.5, ...
        0.49249999999999999, ...
        0.42499999999999999, ...
        0.80300000000000005, ...
        0.5, ...
        0.69999999999999996, ...
        0.59999999999999998, ...
        0.54300000000000004, ...
        0.45500000000000002, ...
        0.503, ...
        0.5, ...
        0.5, ...
        0.55200000000000005, ...
        0.55200000000000005, ...
        0.55200000000000005, ...
        0.55200000000000005, ...
        0.54249999999999998, ...
        0.52900000000000003, ...
        0.75, ...
        0.75, ...
        0.59999999999999998, ...
        0.59999999999999998, ...
        0.50700000000000001, ...
        0.56599999999999995, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.55000000000000004, ...
        0.5, ...
        0.5, ...
        0.59999999999999998, ...
        0.59999999999999998, ...
        0.5, ...
        0.5, ...
        0.38650000000000001, ...
        0.5, ...
        0.49249999999999999, ...
        0.42499999999999999, ...
        0.80300000000000005, ...
        0.5, ...
        0.69999999999999996, ...
        0.59999999999999998, ...
        0.54300000000000004, ...
        0.45500000000000002, ...
        0.503];
    muscleRatio = containers.Map(muscleKeys, ratioVals);
    
    
    modelProcessor = ModelProcessor(modelFilename);
    % modelProcessor.append(ModOpAddExternalLoads('grf_walk.xml'));
    % modelProcessor.append(ModOpIgnoreTendonCompliance());
    % modelProcessor.append(ModOpReplaceMusclesWithDeGrooteFregly2016());
    % modelProcessor.append(ModOpIgnorePassiveFiberForcesDGF());
    % modelProcessor.append(ModOpScaleActiveFiberForceCurveWidthDGF(1.5));
    % modelProcessor.append(ModOpAddReserves(1.0));

    model = modelProcessor.process();
    
    muscleSet = model.getMuscles();
    numMuscles = muscleSet.getSize();
    
    probe_all = Umberger2010MuscleMetabolicsProbe();
    probe_all.setName('all_metabolics');
    
    probe_act = Umberger2010MuscleMetabolicsProbe();
    probe_act.setName('all_activation_maintenance_rate');
    probe_act.set_activation_maintenance_rate_on(true);
    probe_act.set_shortening_rate_on(false);
    probe_act.set_basal_rate_on(false);
    probe_act.set_mechanical_work_rate_on(false);

    probe_short = Umberger2010MuscleMetabolicsProbe();
    probe_short.setName("all_shortening_rate");
    probe_short.set_activation_maintenance_rate_on(false);
    probe_short.set_shortening_rate_on(true);
    probe_short.set_basal_rate_on(false);
    probe_short.set_mechanical_work_rate_on(false);

    probe_basal = Umberger2010MuscleMetabolicsProbe();
    probe_basal.setName("all_basal_rate");
    probe_basal.set_activation_maintenance_rate_on(false);
    probe_basal.set_shortening_rate_on(false);
    probe_basal.set_basal_rate_on(true);
    probe_basal.set_mechanical_work_rate_on(false);

    probe_mech = Umberger2010MuscleMetabolicsProbe();
    probe_mech.setName("all_mechanical_work_rate");
    probe_mech.set_activation_maintenance_rate_on(false);
    probe_mech.set_shortening_rate_on(false);
    probe_mech.set_basal_rate_on(false);
    probe_mech.set_mechanical_work_rate_on(true);    

    for m = 0:numMuscles-1
        musc = muscleSet.get(m);
        muscName = musc.getName();
        muscName = char(muscName);
        probe_all.addMuscle(muscName, muscleRatio(muscName));
        probe_act.addMuscle(muscName, muscleRatio(muscName));
        probe_short.addMuscle(muscName, muscleRatio(muscName));
        probe_basal.addMuscle(muscName, muscleRatio(muscName));
        probe_mech.addMuscle(muscName, muscleRatio(muscName));
    end
    
    model.addProbe(probe_all);
    model.addProbe(probe_act);
    model.addProbe(probe_short);
    model.addProbe(probe_basal);
    model.addProbe(probe_mech);
    
    %{
        % save this for later when everything is actually working
        
        for m = 0:numMuscles-1
            musc = muscleSet.get(m);
            muscName = musc.getName();
            muscName = char(muscName);
            
            % add a probe for each muscle
            probe = Umberger2010MuscleMetabolicsProbe();
            probe.setName(strcat("metabolics_", muscName));
            probe.addMuscle(muscName, muscleRatio(muscName));
            model.addProbe(probe);
            
            probe = Umberger2010MuscleMetabolicsProbe();
            probe.setName(strcat('activation_maintenance_rate_',muscName));
            probe.set_activation_maintenance_rate_on(true);
            probe.set_shortening_rate_on(false);
            probe.set_basal_rate_on(false);
            probe.set_mechanical_work_rate_on(false);
            probe.addMuscle(muscName, muscleRatio(muscName));
            model.addProbe(probe);
            
            probe = Umberger2010MuscleMetabolicsProbe();
            probe.setName(strcat("shortening_rate_",muscName));
            probe.set_activation_maintenance_rate_on(false);
            probe.set_shortening_rate_on(true);
            probe.set_basal_rate_on(false);
            probe.set_mechanical_work_rate_on(false);
            probe.addMuscle(muscName, muscleRatio(muscName));
            model.addProbe(probe);
            
            probe = Umberger2010MuscleMetabolicsProbe();
            probe.setName(strcat("basal_rate_",muscName));
            probe.set_activation_maintenance_rate_on(false);
            probe.set_shortening_rate_on(false);
            probe.set_basal_rate_on(true);
            probe.set_mechanical_work_rate_on(false);
            probe.addMuscle(muscName, muscleRatio(muscName));
            model.addProbe(probe);
            
            probe = Umberger2010MuscleMetabolicsProbe();
            probe.setName(strcat("mechanical_work_rate_",muscName));
            probe.set_activation_maintenance_rate_on(false);
            probe.set_shortening_rate_on(false);
            probe.set_basal_rate_on(false);
            probe.set_mechanical_work_rate_on(true);
            probe.addMuscle(muscName, muscleRatio(muscName));
            model.addProbe(probe);
            
        end
    %}
    
    model.finalizeConnections();
    model.print('simple_model_all_the_probes.osim');  
end
